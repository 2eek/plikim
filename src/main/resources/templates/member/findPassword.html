<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
<head th:replace="fragments/common:: head('로그인')">
<!--<link rel="icon" th:href="@{https://plikim.com/favicon.ico}" type="image/x-icon" />-->

</head>
   <!-- 이미지 프리로딩을 위한 숨겨진 이미지 태그 -->
<img src="/img/space4.jpeg" alt="Preloaded Image" style="display: none;">

    <!-- 웹 페이지의 나머지 내용 -->

    <script>
        // 이미지 프리로딩을 위한 JavaScript 코드
        var preloadedImage = new Image();
        preloadedImage.src = "/img/space4.jpeg";
    </script>

<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top" th:replace="fragments/common :: menu('login')">
</nav>
<!--    <link rel="stylesheet" href="style.css"> -->
<style>
/** {*/
/*	margin: 0; ,*/
/*	padding: 0;*/
/*	font-family: sans-serif;*/
/*}*/

.wrap {
	display: flex;
	flex-direction: row;
	justify-content: center;
	align-items: center;
	height: 100%;
	width: 100%;
	background-position: center;
	background-size: cover;
	/*position: relate;*/
}

body {
    background-image: url('/img/space4.jpeg');
    /*background-color: #777777;*/
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    height: 100vh; /* 추가된 부분 */
}

.form-wrap {
  width: 380px;
    height: 480px;
	position: relative;
	background: #fff;
	overflow: hidden;
	 border-radius: 30px;
}


.button-wrap {
	width: 300px;
	margin: 35px auto;
	position: relative;
	border-radius: 30px;
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.togglebtn {
	padding: 5px 10px;
	margin-left: 8px;
	/*  margin-right : 10px; */
	cursor: pointer;
	background: transparent;
	border: 0;
	outline: none;
	position: relative;
}

#btn {

    left: 0;

    position: absolute;
    width: 150px;
    height: 100%;
    background:  #1fa3d7;
    border-radius: 30px;
    transition: .5s;
}


.social-icons img {
	padding: 5px;
	width: 300px;
	cursor: pointer;
}

.input-group {
	top: 150px;
	position: absolute;
	width: 280px;
	transition: .5s;
}






span {
	color: #777;
	font-size: 12px;
	bottom: 68px;
	/* position: absolute; */
}

#member {
	left: 50px;
}

#updatePasword {
	left: 450px;
}

#find {
	text-align: center;
}

#find a.property-sub {
	display: inline-block;
}




#approveButton, #code, #sendBtn, #confirmBtn {
    border: 1px solid #ccc;
    padding: 5px 10px;
}

</style>




</head>
<body>




	<div class="wrap">
		<div class="form-wrap">
			<div class="button-wrap">
				<div id="btn"></div>
				<div type="button" class="togglebtn" onclick="member()"> &nbsp; &nbsp;아이디
					찾기</div>
				<div type="button" class="togglebtn" onclick="updatePasword()">비밀번호
					찾기 &nbsp; &nbsp;</div>
			</div>

			<!-- 아이디 찾기 -->
			<form id="member"  class="input-group">
				<div>
					<h3>아이디 찾기</h3>
					<p style="font-size: 95%;">"계정에 등록된 휴대폰 번호를 인증하시면 사용중인 계정 아이디를
						알려드려요."</p>
				</div>
				<font id="checkId" size="2"></font>
				<!-- required  -->
				<font id="" size="2"></font>
				<div class="inputclass">
					<label for="Number" class="form-label" style="margin-bottom: 0;">전화번호 &nbsp; </label>

					<div class="input-container">
						<div class="label-container">
							<!-- 추가된 div로 라벨과 인풋창을 감싸서 정렬을 수행 -->
						</div>
						<input type="text" class="form" name="to" id="Number" placeholder="전화번호를 입력하세요" required>
						  <button type="button" id="approveButton" class="btn btn-default">인증 요청</button>
					</div>
<!--				<br>-->

				</div>
				<div id="codeCheck" style="display: none">

					<div>
						<input type="text" class="form" name="smsCode" id="smsCode" placeholder="코드 입력하세요" required>
						<button type="button" id="code" name="codeConfirmBtn" class="btn btn-default" onclick="confirmCode()" value="">인증</button>

					</div>

				</div>
				<input type="hidden" id="numValue" value="">
<!--				<br>-->
			</form>

			<!--  비밀번호 찾기 -->
			<form id="updatePasword" action="/updatePaswordForm" method="post" class="input-group">
				<div class="wrap-loading display-none">
<!--    				<div><img src="/img/mailsending.gif" /></div>-->
				</div>
				<div>
					<h3>비밀번호 찾기</h3>
					<p style="font-size: 95%;">"계정에 등록된 이메일 인증을 해주세요. "</p>
				</div>

				<!-- required  -->
				<font id="checkId1" size="2"></font>

				<div id="mail_input" >
					<!--서버로 보낼 데이터 (input에 넣은 이메일을 서버로 보냄)  -->
					<input  type="text" name="email" id="mail" value=""
						placeholder="이메일 입력" style="width: 185px; , float: left; margin-right: 5px;"  class="form">
					<button type="button" id="sendBtn" name="sendBtn"
						onclick="sendNumber()" class="btn btn-default">인증 요청</button>
				</div>
<!--				<br>-->
				<br>
				<div id="mail_number" name="mail_number" style="display: none">
					<input type="text" id="mail_input_code" name="number"  style="width: 185px; , float: left; margin-right: 5px;"class="form"  placeholder="인증번호 입력">

					<button type="button" name="confirmBtn" id="confirmBtn"
						onclick="confirmNumber()" class="btn btn-default"> 인증</button>
				</div>
				<br> <input type="text" id="Confirm" name="Confirm"
					style="display: none" value="">

			</form>

		</div>
	</div>



	<script>

	//슬라이드

		var x = document.getElementById("member");
		var y = document.getElementById("updatePasword");
		var z = document.getElementById("btn");
		function member() {
			x.style.left = "50px";
			y.style.left = "450px";
			z.style.left = "0";
		}

		function updatePasword() {
			x.style.left = "-400px";
			y.style.left = "50px";
			z.style.left = "150px";
		}
		 updatePasword();
	</script>

	<!-- 로그인시 아이디 비밀번호 DB에 있는지 확인 -->
	<script>
		//이벤트 핸들링 등록. HTML 요소가 모두 로딩된 이후에 이루어져야 하므로.
		$(document).ready(function() {
			// updatePasword();
			//$('#member').on('submit', loginAccountcheck);
			//$('#guide').on('submit', loginAccountcheck1);
			// findAccountId();
			//UpdatePasswordForm();
		});
	</script>


	<!--sms 코드 전송-->
	   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script th:inline="javascript">

		$(document).ready(function() {
		      // 승인 버튼. 클릭(이벤트)발생시  ajaxApprove메서드 실행 설정(핸들러)
		      $('#approveButton').on('click',function(){
		    	  ajaxApprove();

		      });
		});

		   function ajaxApprove(){

			 	console.log("왜안돼")
			 	let phonenumber = document.getElementById("Number").value;
			 	console.log("있나:"+phonenumber);

	       	 	if(phonenumber ==""){

	       		 	alert("휴대폰 번호를 입력하세요.");
	       		 $("#Number").focus();
	       		    	return false;
	       	 }
	      	  sendCode();
			  console.log("sms 버튼 눌렀다.");

		      // memberId 정의


		     $.ajax({
		         url : "/sms/send",
		         type : 'post',
		         data: {
		        	 to : phonenumber
		        	 },
		      })
		      .done( data => {
		         console.log("data :", data);
		         console.log("통신은 성공");
		         if(data != null && data.num != null){
		            alert(`${phonenumber } 문자발송했습니다`);

		            $("#numValue").val(data.num);
		         } else {
		            alert(`문자 발송 안됐습니다.`);
		         }
		      })
		      .fail( reject => console.log(reject));
		   };



		   //코드 보내고 활성화 시킴
		   function sendCode(){
			    $("#codeCheck").css("display","block");
			    }

			function confirmCode(){
			   var number1 = $("#smsCode").val();
			   var number2 = $("#numValue").val();
			  	console.log(number1)
		           console.log(number2)

		        if (number1 == number2) { // 저장된 SMS 코드를 사용
		            alert("인증되었습니다.")
		            //console.log(NumberCheck);
		        	findAccountId();


		        } else {
		            alert("번호가 다릅니다.");
		        }
		    }


		//아작스로 인증된 휴대전화 번호에 맞는 아이디 띄우기
	        function findAccountId(){
	        //preventDefault();
	        let phoneNumberCheck = document.getElementById("Number").value; // input_id에 입력되는 값
	        console.log(phoneNumberCheck);

	      $.ajax({
	         /* url : "IdCheckService", */
	         url : "/phoneNumberCheck",
	         type : "post",
	         data :  {phoneNumber :phoneNumberCheck},
	         dataType : 'json',

	         success : function(result){
	        	 console.log(result);
	            if(result == 0){


	               $("#checkId").html('없는 전화번호 입니다.');
	               $("#checkId").attr('color','red');//멈춰야함


	            } else{
	               //event.unbind();
	               $("#checkId").html('회원님의 아이디는<h3 style="display: inline;">'+result.userId+'</h3>입니다.');
	               $("#checkId").attr('color','green');
	               //$('#guide')[0].submit();
	            }
	         },
	         error : function(){
	            //alert("서버요청실패");
	         }
	      });
	      //$('#member').submit();
		}





	         function sendNumber(){
	                var email = document.getElementById("mail");
	            	 if(email.value == ""){
	            		 alert("이메일을 입력하세요.");
	            		    email.focus();
	            		    return false;

	            	 }
	                $("#mail_number").css("display","block");
	                $('.wrap-loading').removeClass('display-none');
	                $.ajax({
	                    url:"/mail",
	                    type:"post",
	                    //받아오는 데이터 형식
	                    dataType:"json",
	                    data:{"mail" : $("#mail").val()},
	                    success: function(data){

	                        alert("인증번호 발송했습니다.");
	                        $('.wrap-loading').addClass('display-none');
	                        $("#Confirm").attr("value",data);
							console.log(data)
	                    }
	                });
	            }

	            function confirmNumber(){
	                var number1 = $("#mail_input_code").val();
					// console.log(number1)
	                var number2 = $("#Confirm").val();
						// console.log(number2)

	                if(number1 == number2){
	                    alert("인증되었습니다.");
	                    var updateForm  = document .getElementById( "updatePasword" );
	                    updateForm.submit();
	                }else{
	                    alert("번호가 다릅니다.");
	                }
	            }



	</script>



</body>
</html>

