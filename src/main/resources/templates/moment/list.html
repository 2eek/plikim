<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<style>
    .user-table {
        float: left;
        width: 100px; /* 너비를 100px로 설정 */
        margin-right: 20px;
    }

    .user-table th, .user-table td {
        font-size: 12px;
    }

    .user-row {
        cursor: pointer;
    }

    /* 추가된 스타일 */
    .form-container {
        margin-top: 20px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
    }

    .input-area {
        width: 100%;
        height: 100px;
        margin-bottom: 10px;
    }

    .image-upload {
        margin-bottom: 10px;
    }

    .button-container {
        text-align: right;
    }

    .button-container button {
        margin-left: 10px;
    }

    .selected-images {
        display: flex;
    }

    .selected-images img {
        max-width: 100px;
        max-height: 100px;
        margin-right: 10px;
    }



</style>

<head th:replace="fragments/common :: head('moment')">
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top" th:replace="fragments/common :: menu('moment')">
</nav>

<div id="content" th:fragment="content">
    <!-- Thymeleaf fragment로 content를 정의 -->
</div>
<!-- 추가된 폼 -->
<div class="form-container">
    <textarea class="input-area" placeholder="5줄 정도 입력하세요" maxlength="200"></textarea>

    <!-- 파일 선택 input -->
<!--    <input type="file" class="image-upload" accept="image/*" multiple onchange="previewImages(this)">-->
<input id="upload_file" type="file" class="image-upload" accept="image/*" multiple onchange="onChange(event)"style="position:absolute; clip:rect(0, 0, 0, 0);">
<label for="upload_file" style="border: 1px solid darkgray; padding: 5px; cursor: pointer; display: inline-block; background-color: #f0f0f0; border-radius: 5px;">
    업로드
</label>    <!-- 이미지 미리보기 영역 -->
    <div id="image-preview-container" class="selected-images"></div>


    <div class="button-container">
        <button onclick="submitForm()">입력</button>
        <button onclick="updateForm()">수정</button>
        <button onclick="deleteForm()">삭제</button>
    </div>
</div>

<script th:inline="javascript">
let selectedImages = [];

function onChange(event) {
    previewImages(event.target.files);
    event.target.value = '';
}

function previewImages(files) {
    const previewContainer = document.getElementById('image-preview-container');

    // 최대 3개까지만 미리보기 표시
    for (let i = 0; i < Math.min(files.length, 3); i++) {
        const file = files[i];

        // 이미지가 3개를 넘어가면 alert 창 띄우고 추가 중단
        if (selectedImages.length >= 3) {
            alert('최대 3개까지만 선택할 수 있습니다.');
            break;
        }

        // 선택된 이미지 배열에 추가
        selectedImages.push(file);

        // 미리보기 이미지 엘리먼트 생성 및 추가
        const previewImg = createPreviewImage(file);
        previewContainer.appendChild(previewImg);
    }
}

function createPreviewImage(file) {
    const previewImg = document.createElement('img');
    previewImg.src = URL.createObjectURL(file);
    previewImg.alt = 'Image Preview';
    previewImg.style.width = '100px';  // 이미지 너비를 100px로 설정
    previewImg.style.height = '100px'; // 이미지 높이를 100px로 설정

    // 이미지 클릭 시 제거 이벤트 리스너 추가
    previewImg.addEventListener('click', () => removePreviewImage(previewImg, file));

    return previewImg;
}

function removePreviewImage(previewImg, file) {
    const index = selectedImages.indexOf(file);
    if (index !== -1) {
        selectedImages.splice(index, 1);  // 배열에서 해당 파일 제거
    }

    previewImg.remove();  // 뷰에서 해당 이미지 제거
}



    function updateForm() {
        console.log('Update button clicked');
        // 여기에 수정 로직 추가
    }

    function deleteForm() {
        console.log('Delete button clicked');
        // 여기에 삭제 로직 추가
    }

    <!--        무한스크롤-->
    let page = 1;

    function fetchMoreContent() {
        // Simulating an asynchronous request to the server
        setTimeout(() => {
            fetch(`/moment/data?page=${page}`)
                .then(response => response.json())
                .then(data => {
                    const contentDiv = document.getElementById('content');
                    data.forEach(moment => {
                        const momentDiv = document.createElement('div');
                        momentDiv.textContent = moment.text;
                        contentDiv.appendChild(momentDiv);
                    });
                    page++;
                })
                .catch(error => console.error('Error fetching data:', error));
        }, 1000); // Simulating network delay
    }

    function handleScroll() {
        const contentDiv = document.getElementById('content');
        if (contentDiv.scrollHeight - contentDiv.scrollTop === contentDiv.clientHeight) {
            fetchMoreContent();
        }
    }

    document.getElementById('content').addEventListener('scroll', handleScroll);

    // Initial content load
    fetchMoreContent();
</script>
</body>
</html>
