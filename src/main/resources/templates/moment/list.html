<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<style>
    .user-table {
        float: left;
        width: 100px; /* 너비를 100px로 설정 */
        margin-right: 20px;
    }

    .user-table th, .user-table td {
        font-size: 12px;
    }

    .user-row {
        cursor: pointer;
    }

        /* 추가된 스타일 */
        .form-container {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        .input-area {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
        }

        .image-upload {
            margin-bottom: 10px;
        }

        .button-container {
            text-align: right;
        }

        .button-container button {
            margin-left: 10px;
        }

</style>

<head th:replace="fragments/common :: head('moment')">
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top" th:replace="fragments/common :: menu('moment')">
</nav>

<div id="content" th:fragment="content">
    <!-- Thymeleaf fragment로 content를 정의 -->
</div>
<!-- 추가된 폼 -->
<div class="form-container">
    <textarea class="input-area" placeholder="5줄 정도 입력하세요"></textarea>

    <!-- 파일 선택 input -->
    <input type="file" class="image-upload" accept="image/*" onchange="previewImage(this)">

    <!-- 이미지 미리보기 영역 -->
    <img id="image-preview" class="image-preview" alt="Image Preview">

    <div class="button-container">
        <button onclick="submitForm()">입력</button>
        <button onclick="updateForm()">수정</button>
        <button onclick="deleteForm()">삭제</button>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/  // Thymeleaf에서 JavaScript 코드를 사용할 때 CDATA 선언을 사용합니다.

    // 입력, 수정, 삭제 기능 예시 함수
    function submitForm() {
        console.log('Submit button clicked');
        // 여기에 입력 로직 추가
    }

    function updateForm() {
        console.log('Update button clicked');
        // 여기에 수정 로직 추가
    }

    function deleteForm() {
        console.log('Delete button clicked');
        // 여기에 삭제 로직 추가
    }

    /*]]>*/
</script>
<script th:inline="javascript">
    /*<![CDATA[*/  // Thymeleaf에서 JavaScript 코드를 사용할 때 CDATA 선언을 사용합니다.
    function previewImage(input) {
        const preview = document.getElementById('image-preview');
        const file = input.files[0];

        if (file) {
            const reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;
            };

            reader.readAsDataURL(file);
        }
    }

    let page = 1;

    function fetchMoreContent() {
        // Simulating an asynchronous request to the server
        setTimeout(() => {
            fetch(`/moment/data?page=${page}`)
                .then(response => response.json())
                .then(data => {
                    const contentDiv = document.getElementById('content');
                    data.forEach(moment => {
                        const momentDiv = document.createElement('div');
                        momentDiv.textContent = moment.text;
                        contentDiv.appendChild(momentDiv);
                    });
                    page++;
                })
                .catch(error => console.error('Error fetching data:', error));
        }, 1000); // Simulating network delay
    }

    function handleScroll() {
        const contentDiv = document.getElementById('content');
        if (contentDiv.scrollHeight - contentDiv.scrollTop === contentDiv.clientHeight) {
            fetchMoreContent();
        }
    }

    document.getElementById('content').addEventListener('scroll', handleScroll);

    // Initial content load
    fetchMoreContent();

    /*]]>*/
</script>
</body>
</html>
